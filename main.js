/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var M=Object.create;var P=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var U=Object.getOwnPropertyNames;var D=Object.getPrototypeOf,T=Object.prototype.hasOwnProperty;var G=(o,u)=>{for(var t in u)P(o,t,{get:u[t],enumerable:!0})},R=(o,u,t,a)=>{if(u&&typeof u=="object"||typeof u=="function")for(let c of U(u))!T.call(o,c)&&c!==t&&P(o,c,{get:()=>u[c],enumerable:!(a=C(u,c))||a.enumerable});return o};var $=(o,u,t)=>(t=o!=null?M(D(o)):{},R(u||!o||!o.__esModule?P(t,"default",{value:o,enumerable:!0}):t,o)),H=o=>R(P({},"__esModule",{value:!0}),o);var A={};G(A,{default:()=>v});module.exports=H(A);var h=require("obsidian"),w=$(require("path")),L=require("child_process"),K={githubRepoUrl:"",localMarkdownPath:"",gitPassword:""},v=class extends h.Plugin{async onload(){await this.loadSettings(),this.addRibbonIcon("cloud-lightning","Krems Publisher",t=>{new x(this.app,this).open()}),this.addSettingTab(new S(this.app,this)),console.log("Krems Obsidian Plugin loaded.")}onunload(){console.log("Krems Obsidian Plugin unloaded.")}async loadSettings(){this.settings=Object.assign({},K,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async execShellCommand(t,a){return new Promise((c,y)=>{(0,L.exec)(t,{cwd:a},(l,m,d)=>{if(l){console.error(`exec error: ${l.message}`),y(`Error: ${l.message}
Stderr: ${d}`);return}d&&console.warn(`exec stderr: ${d}`),c(m.trim())})})}},x=class extends h.Modal{constructor(t,a){super(t);this.plugin=a}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"Krems Publisher Actions"});let a=t.createDiv({cls:"krems-modal-section"});a.createEl("h4",{text:"1. Initialize Local Directory"}),a.createEl("p",{text:`This will clone krems-example into your specified local directory (${this.plugin.settings.localMarkdownPath||"not set"}) and set its remote to your GitHub repo.`});let c=a.createEl("button",{text:"Initialize Directory"}),y=a.createEl("div",{cls:"krems-feedback",attr:{style:"margin-top: 10px;"}}),l=(n,f)=>{y.textContent=n,y.className=`krems-feedback krems-feedback-${f}`};c.addEventListener("click",async()=>{let{localMarkdownPath:n,githubRepoUrl:f}=this.plugin.settings;if(!n||!f){l("Error: Local Markdown Directory and GitHub Repo URL must be set in plugin settings.","error");return}let E=this.app.vault.adapter.getBasePath(),g=w.join(E,n);try{let b=this.app.vault.adapter;if(await b.exists(g)){let k=await b.stat(g);if(k&&k.type==="folder"){let p=await b.list(g);if(p.files.length>0||p.folders.length>0){l(`Error: Directory '${n}' already exists and is not empty. Please choose an empty or new directory.`,"error");return}}else{l(`Error: Path '${n}' exists but is not a directory.`,"error");return}}}catch(b){console.log("Directory check for init:",b)}c.disabled=!0,l("Cloning krems-example repository...","status");try{let b=`git clone https://github.com/mreider/krems-example "${g}"`;await this.plugin.execShellCommand(b,E),l("Repository cloned. Setting remote URL...","status");let k=`git -C "${g}" remote set-url origin "${f}"`;await this.plugin.execShellCommand(k,E),l("Remote URL set. Cleaning up README.md...","status");let p=w.join(g,"README.md");await this.app.vault.adapter.exists(p)?(await this.app.vault.adapter.remove(p),l("Directory initialized successfully! README.md removed.","success")):l("Directory initialized successfully! (README.md not found to remove).","success")}catch(b){console.error("Initialization error:",b),l(`Initialization failed: ${b}`,"error")}finally{c.disabled=!1}}),(!this.plugin.settings.localMarkdownPath||!this.plugin.settings.githubRepoUrl)&&(c.disabled=!0,a.createEl("p",{text:"Please set Local Markdown Directory and GitHub Repo URL in settings.",cls:"krems-warning"}));let m=t.createDiv({cls:"krems-modal-section"});m.createEl("h4",{text:"3. Push Site to GitHub"}),m.createEl("p",{text:`This will add, commit, and push the content of '${this.plugin.settings.localMarkdownPath||"not set"}' to your GitHub repo.`});let d=m.createEl("input",{type:"text",placeholder:"Optional commit message (default: latest site version)"});d.style.width="100%",d.style.marginBottom="10px";let s=m.createEl("button",{text:"Push to GitHub"}),i=m.createEl("div",{cls:"krems-feedback",attr:{style:"margin-top: 10px;"}}),e=(n,f)=>{i.textContent=n,i.className=`krems-feedback krems-feedback-${f}`};s.addEventListener("click",async()=>{let{localMarkdownPath:n,githubRepoUrl:f}=this.plugin.settings;if(!n||!f){e("Error: Local Markdown Directory and GitHub Repo URL must be set in plugin settings.","error");return}let E=this.app.vault.adapter.getBasePath(),g=w.join(E,n),k=(d.value.trim()||"latest site version").replace(/"/g,'\\"');s.disabled=!0,d.disabled=!0,e("Preparing to push site...","status");try{try{await this.plugin.execShellCommand("git config user.name",g),await this.plugin.execShellCommand("git config user.email",g),e("Git user identity found. Proceeding...","status")}catch(p){e("Git user identity not found, setting default for this commit...","status"),await this.plugin.execShellCommand('git config user.name "Krems Obsidian Plugin"',g),await this.plugin.execShellCommand('git config user.email "krems-plugin@example.com"',g)}e("Adding files (git add .)...","status"),await this.plugin.execShellCommand("git add .",g),e(`Committing with message: "${k}"...`,"status");try{await this.plugin.execShellCommand(`git commit -m "${k}"`,g)}catch(p){if(p.toString().includes("nothing to commit"))e("No changes to commit. Proceeding to push...","status");else throw p}e("Pushing to remote repository...","status"),await this.plugin.execShellCommand("git push",g),e("Site pushed successfully!","success")}catch(p){console.error("Push error:",p),e(`Push failed: ${p}`,"error")}finally{s.disabled=!1,d.disabled=!1}}),(!this.plugin.settings.localMarkdownPath||!this.plugin.settings.githubRepoUrl)&&(s.disabled=!0,d.disabled=!0,m.createEl("p",{text:"Please set Local Markdown Directory and GitHub Repo URL in settings.",cls:"krems-warning"})),t.createEl("hr");let r=t.createEl("p",{cls:"krems-modal-footer"});r.setText("For help, see the "),r.createEl("a",{text:"plugin documentation",href:"https://github.com/mreider/krems-obsidian-plugin/",attr:{target:"_blank",rel:"noopener noreferrer"}}),r.appendText(".")}onClose(){let{contentEl:t}=this;t.empty()}},S=class extends h.PluginSettingTab{constructor(t,a){super(t,a);this.plugin=a}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Krems Publisher Settings"});let a=(s,i,e,r)=>{s.classList.remove("krems-input-valid","krems-input-invalid"),i.classList.remove("krems-feedback-valid","krems-feedback-invalid"),i.textContent=e,i.style.display=e?"block":"none",e&&(s.classList.add(r?"krems-input-valid":"krems-input-invalid"),i.classList.add(r?"krems-feedback-valid":"krems-feedback-invalid"))},c=new h.Setting(t).setName("GitHub Repository URL").setDesc("HTTPS URL of your GitHub repository (e.g., https://github.com/username/repo). Do not include .git at the end."),y=c.controlEl.createEl("div",{cls:"krems-setting-feedback",attr:{id:"repo-url-feedback",style:"display: none; margin-top: 5px;"}});c.addText(s=>{s.setPlaceholder("https://github.com/username/repo").setValue(this.plugin.settings.githubRepoUrl).onChange(async i=>{this.plugin.settings.githubRepoUrl=i.trim(),await this.plugin.saveSettings()}),s.inputEl.addEventListener("focusout",async()=>{let i=this.plugin.settings.githubRepoUrl,e=!0,r="";if(!i){a(s.inputEl,y,"",!0);return}if(!i.startsWith("https://github.com/"))e=!1,r="URL must start with https://github.com/";else if(i.endsWith(".git"))e=!1,r="URL should not end with .git";else{let n=i.substring(19).split("/");(n.length<2||!n[0]||!n[1])&&(e=!1,r="Invalid GitHub repository URL format.")}e&&r===""&&(r="URL format is valid."),a(s.inputEl,y,r,e)}),this.plugin.settings.githubRepoUrl&&s.inputEl.dispatchEvent(new Event("focusout"))});let l=new h.Setting(t).setName("Local Markdown Directory").setDesc("Path to the directory in your vault for your Krems site (e.g., MyKremsSite)."),m=l.controlEl.createEl("div",{cls:"krems-setting-feedback",attr:{id:"local-path-feedback",style:"display: none; margin-top: 5px;"}});l.addText(s=>{s.setPlaceholder("e.g., MyKremsSite or path/to/site").setValue(this.plugin.settings.localMarkdownPath).onChange(async i=>{this.plugin.settings.localMarkdownPath=i.trim(),await this.plugin.saveSettings()}),s.inputEl.addEventListener("focusout",async()=>{let i=this.plugin.settings.localMarkdownPath,e=!1,r="";if(!i){a(s.inputEl,m,"",!0);return}let n=this.app.vault.getAbstractFileByPath(i);n&&n instanceof h.TFolder?(e=!0,r="Directory exists."):(e=!1,r="Directory not found in the vault."),a(s.inputEl,m,r,e)}),this.plugin.settings.localMarkdownPath&&s.inputEl.dispatchEvent(new Event("focusout"))}),new h.Setting(t).setName("Git Token/Password (Optional)").setDesc("Enter your Git password or Personal Access Token (PAT) if required for push operations. PAT is recommended for security.").addText(s=>{s.inputEl.type="password",s.setPlaceholder("Enter your Git token/password").setValue(this.plugin.settings.gitPassword||"").onChange(async i=>{this.plugin.settings.gitPassword=i,await this.plugin.saveSettings()})}),t.createEl("hr");let d=t.createEl("p",{cls:"krems-settings-footer"});d.setText("For plugin instructions, troubleshooting, and more information, please visit the "),d.createEl("a",{text:"plugin documentation on GitHub",href:"https://github.com/mreider/krems-obsidian-plugin/",attr:{target:"_blank",rel:"noopener noreferrer"}}),d.setText(".")}};
